stages:
  - test
  - build
  - deploy

test_job:
  stage: test
  image: php:8.2-cli
  script:
    - php tests/search_test.php

build_job:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  script:
    - docker build -t gitlab-cicd-demo --build-arg CI_PROVIDER=GitLab .
    - docker save gitlab-cicd-demo | gzip > gitlab-image.tar.gz
  artifacts:
    paths:
      - gitlab-image.tar.gz
  needs: [test_job]

simulate_deploy:
  stage: deploy
  image: alpine:latest
  script:
    - echo "üöÄ Starting deployment simulation‚Ä¶"
    - echo " ‚Ä¢ –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É‚Ä¶"
    - sleep 1
    - echo " ‚Ä¢ –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã‚Ä¶"
    - sleep 1
    - echo " ‚Ä¢ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–∏—Å—ã‚Ä¶"
    - sleep 1
    - echo "‚úÖ Deployment simulation completed!"
  when: manual     # –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
  only:
    - main
